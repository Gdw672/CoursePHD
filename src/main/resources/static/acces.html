<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Access</title>
    <style>
        table {
            border: 2px solid #000;
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            border: 1px solid #000;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>

    <table id="myTable">
    </table>
    <button onclick="createTable(3)">Создать таблицу</button>
    <button onclick="tryWriteValue()">Попробовать записать ивент</button>
    <button onclick="logEvent()">Вывести ивент</button>
</head>
<body>
<h1 id="username">Hi, </h1>


<script src="AuthPage.js"></script>

<script>
    var usernameValue = getCookie("username");
    var events = null;

    if (usernameValue) {
        document.getElementById("username").innerText = "Hi, " + usernameValue;
    }

 function createTable(rows) {
    var table = document.getElementById("myTable");
    table.innerHTML = "";

    var headerRow = table.insertRow(0);
    var headers = ["name", "country", "description", "receivedDate"];
    for (var j = 0; j < 4; j++) {
        var cell = headerRow.insertCell(j);
        cell.innerHTML = headers[j];
    }

    for (var i = 1; i <= events.length; i++) {
        var row = table.insertRow(i);
        for (var j = 0; j < 4; j++) {
            var cell = row.insertCell(j);
            if(cell.cellIndex == 0) {
            cell.innerHTML = events[i-1].name;
            }
           else if(cell.cellIndex == 1) {
             cell.innerHTML = events[i-1].country;
            }
           else if(cell.cellIndex == 2) {
             cell.innerHTML = events[i-1].description;
            }
           else if(cell.cellIndex == 3) {
             cell.innerHTML = events[i-1].receivedDate;
            }
            else {
              cell.innerHTML = "Строка " + i + ", столбец " + (j + 1);
            }
        }
    }
}

function tryWriteValue() {
    fetch('/getAllEvents', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        events = data;
        logEvent();
    })
    .catch(error => {
        console.error('There has been a problem with your fetch operation:', error);
    });
}

function logEvent() {

console.log(events);

console.log(events[0]);
console.log(events[1]);
}
</script>
</body>
</html>
